!function(e,r){if("function"==typeof define&&define.amd)define("gulpEasyTaskBabelModuleId1667380",["exports","module","babel-runtime/helpers/sliced-to-array","babel-runtime/regenerator","babel-runtime/core-js/promise","babel-runtime/core-js/number/is-nan","cheerio","babel-runtime/helpers/interop-require-default","lodash","html-taiwan-address-digger","async-q","debug","he","html-img-digger","request-promise","isostring"],r);else if("undefined"!=typeof exports&&"undefined"!=typeof module)r(exports,module,require("babel-runtime/helpers/sliced-to-array"),require("babel-runtime/regenerator"),require("babel-runtime/core-js/promise"),require("babel-runtime/core-js/number/is-nan"),require("cheerio"),require("babel-runtime/helpers/interop-require-default"),require("lodash"),require("html-taiwan-address-digger"),require("async-q"),require("debug"),require("he"),require("html-img-digger"),require("request-promise"),require("isostring"));else{var t={exports:{}};r(t.exports,t,e._slicedToArray,e._regeneratorRuntime,e._Promise,e._Number$isNaN,e.$,e._interopRequireDefault,e._,e.addressDigger,e.async,e.debug,e.he,e.imgDigger,e.request,e.isISOString),e.gulpEasyTaskBabelModuleId1667380=t.exports}}(this,function(e,r,t,n,u,a,i,l,d,s,f,o,c,m,p,g){"use strict";function h(){var e,r,a,i,l,d,s,f,o,c,m,p,g,h=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return n["default"].async(function(b){for(;;)switch(b.prev=b.next){case 0:if(e=D["default"](I.namespace+":find"),h.url&&"string"==typeof h.url){b.next=3;break}return b.abrupt("return",u["default"].reject("Need url. API Documents => crawler.find({ url:String })"));case 3:return e("find "+h.url),b.next=6,n["default"].awrap(T["default"]({method:"GET",url:h.url,json:!1}));case 6:return r=b.sent,a=N["default"](r),i=a.find("#article-area").find("script,style,textarea").remove().end(),l="",l=i.html().trim(),l=A["default"].decode(l),d=S["default"].dig(l),s=E["default"].dig(l),f=y(i),o=w(i),b.next=18,n["default"].awrap(u["default"].all([d,s]));case 18:return c=b.sent,m=t["default"](c,2),p=m[0],g=m[1],p=p.map(function(e){return 0===e.url.indexOf("//")&&(e.url="http:"+e.url),e.url}),b.abrupt("return",{address:g,body:l,published:f,images:p,title:o,url:h.url});case 24:case"end":return b.stop()}},null,this)}function b(){var e,r,t,a,i,l,d,s=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return n["default"].async(function(f){for(var o=this;;)switch(f.prev=f.next){case 0:if(e=D["default"](I.namespace+":findAll"),s.url&&"string"==typeof s.url){f.next=3;break}return f.abrupt("return",u["default"].reject("Need url, findAll({ url:String })"));case 3:if(r=2,t=s.url,a=s.fetchAll===!0?!0:!1,i=j["default"].range(1,2),l=[],a!==!0){f.next=14;break}return f.next=11,n["default"].awrap(x(t));case 11:d=f.sent,e("部落格總共有 "+d+" 頁，是否強制抓取全部頁面:"+a),i=j["default"].range(1,d+1);case 14:return e("同時開了 "+r+" 條連線，發動請求！"),O.match(/test/i)&&(e("NODE_ENV:"+O+"，處理 pageRanges 變量，使它最多問三頁。"),i=i.slice(0,3)),f.next=18,n["default"].awrap(_["default"].eachLimit(i,r,function(e){var r,u;return n["default"].async(function(a){for(;;)switch(a.prev=a.next){case 0:return r=t+"/"+e,a.next=3,n["default"].awrap(q(r));case 3:u=a.sent,l=l.concat(u);case 5:case"end":return a.stop()}},null,o)}));case 18:return f.abrupt("return",l);case 19:case"end":return f.stop()}},null,this)}function x(e){return T["default"]({method:"GET",url:e,json:!1}).then(function(e){return N["default"](e)}).then(function(e){return v(e)})}function q(e){var r=D["default"](I.namespace+":_crawlList");return r("現在抓取清單，目標: "+e),T["default"]({method:"GET",url:e,json:!1}).then(function(e){return N["default"](e)}).then(function(e){var t=e.find(".article");r("找出有 "+t.length+" 篇文章實例，開始解析各篇文章表面細節。");var n=j["default"].map(t,function(e){var r=N["default"](e),t=y(r),n=w(r),u=r.find(".title"),a=u.find("a").attr("href").trim();return{published:t,title:n,url:a}});return n})}function v(e){var r=e.find(".page a"),t=j["default"].map(r,function(e){var r=Number(N["default"](e).text());return a["default"](r)?0:r}),n=j["default"].max(t);return n}function y(e){var r=e.find(".publish"),t=r.find(".month").text().trim(),n=r.find(".date").text().trim(),u=r.find(".year").text().trim(),a=r.find(".time").text().trim(),i=new Date(t+" "+n+" "+u+" "+a),l=i.toISOString();return l=k["default"](l)?l:""}function w(e){var r=e.find(".title"),t=r.find("a").text().trim();return t}var N=l["default"](i),j=l["default"](d),E=l["default"](s),_=l["default"](f),D=l["default"](o),A=l["default"](c),S=l["default"](m),T=l["default"](p),k=l["default"](g),I=D["default"]("pixnet-posts-crawler"),O=process.env.NODE_ENV||"development";r.exports={find:h,findAll:b}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsIm1vZCIsIl9zbGljZWRUb0FycmF5IiwiX3JlZ2VuZXJhdG9yUnVudGltZSIsIl9Qcm9taXNlIiwiX051bWJlciRpc05hTiIsIiQiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiXyIsImFkZHJlc3NEaWdnZXIiLCJhc3luYyIsImRlYnVnIiwiaGUiLCJpbWdEaWdnZXIiLCJyZXF1ZXN0IiwiaXNJU09TdHJpbmciLCJndWxwRWFzeVRhc2tCYWJlbE1vZHVsZUlkMTY2NzM4MCIsInRoaXMiLCJfYmFiZWxSdW50aW1lSGVscGVyc1NsaWNlZFRvQXJyYXkiLCJfYmFiZWxSdW50aW1lUmVnZW5lcmF0b3IiLCJfYmFiZWxSdW50aW1lQ29yZUpzUHJvbWlzZSIsIl9iYWJlbFJ1bnRpbWVDb3JlSnNOdW1iZXJJc05hbiIsIl9jaGVlcmlvIiwiX2JhYmVsUnVudGltZUhlbHBlcnNJbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfbG9kYXNoIiwiX2h0bWxUYWl3YW5BZGRyZXNzRGlnZ2VyIiwiX2FzeW5jUSIsIl9kZWJ1ZyIsIl9oZSIsIl9odG1sSW1nRGlnZ2VyIiwiX3JlcXVlc3RQcm9taXNlIiwiX2lzb3N0cmluZyIsImZpbmQiLCJsb2ciLCJyZXNwb25zZSIsIiRib2R5IiwiJGFydGljbGUiLCJib2R5IiwiaW1nUSIsImFkZHJlc3NRIiwicHVibGlzaGVkIiwidGl0bGUiLCJfcmVmIiwiX3JlZjIiLCJpbWFnZXMiLCJhZGRyZXNzIiwib3B0cyIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNvbnRleHQkMSQwIiwicHJldiIsIm5leHQiLCJfZGVidWcyIiwibG9nUm9vdCIsIm5hbWVzcGFjZSIsInVybCIsImFicnVwdCIsInJlamVjdCIsImF3cmFwIiwiX3JlcXVlc3QiLCJtZXRob2QiLCJqc29uIiwic2VudCIsIl8kIiwicmVtb3ZlIiwiZW5kIiwiaHRtbCIsInRyaW0iLCJfaGUyIiwiZGVjb2RlIiwiX2ltZ0RpZ2dlciIsImRpZyIsIl9hZGRyZXNzRGlnZ2VyIiwiZGF0ZXRpbWVEaWciLCJ0aXRsZURpZyIsImFsbCIsIm1hcCIsImltZyIsImluZGV4T2YiLCJzdG9wIiwiZmluZEFsbCIsIlRIUkVBRFNfQVRfU0FNRV9USU1FIiwiVVJMIiwiRkVUQ0hfQUxMIiwicGFnZVJhbmdlcyIsImFydGljbGVzIiwibWF4UGFnZUFtb3VudCIsIl90aGlzIiwiZmV0Y2hBbGwiLCJfMiIsInJhbmdlIiwiY3Jhd2xQYWdlcyIsIk5PREVfRU5WIiwibWF0Y2giLCJzbGljZSIsIl9hc3luYyIsImVhY2hMaW1pdCIsInBhZ2UiLCJibG9nVXJsIiwiY3Jhd2xlZCIsImNvbnRleHQkMiQwIiwiY3Jhd2xMaXN0IiwiY29uY2F0IiwidGhlbiIsImJvZHlTdHJpbmciLCJtYXhQYWdlRGlnIiwiJHBvc3RzIiwicG9zdHMiLCJhcnRpY2xlRWxlbWVudCIsIiRlbGVtZW50IiwiJHVybCIsInBvc3RVcmwiLCJhdHRyIiwiYWxpbmtzIiwicGFnZXMiLCJhRWxlbWVudCIsInBhZ2VOdW0iLCJOdW1iZXIiLCJ0ZXh0IiwibWF4UGFnZSIsIm1heCIsIiRwdWIiLCJtb250aCIsImRhdGUiLCJ5ZWFyIiwidGltZSIsImRhdGV0aW1lIiwiRGF0ZSIsImlzb3N0cmluZyIsInRvSVNPU3RyaW5nIiwiX2lzSVNPU3RyaW5nIiwiJHRpdGxlIiwicHJvY2VzcyIsImVudiJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBV0EsRUFBUUMsR0FDakIsR0FBc0Isa0JBQVhDLFNBQXlCQSxPQUFPQyxJQUN6Q0QsT0FBTyxvQ0FBcUMsVUFBVyxTQUFVLHdDQUF5Qyw0QkFBNkIsZ0NBQWlDLHNDQUF1QyxVQUFXLGdEQUFpRCxTQUFVLDZCQUE4QixVQUFXLFFBQVMsS0FBTSxrQkFBbUIsa0JBQW1CLGFBQWNELE9BQzVYLElBQXVCLG1CQUFaRyxVQUE2QyxtQkFBWEMs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L0RpRCxFQUFxQmxELEVBQTBDLFdBQVlFLEdBRTNFdUUsRUFBYXpFLEVBQTBDLFdBQVlHLEdBRW5FMkIsRUFBYzlCLEVBQTBDLFdBQVlJLEdBRXBFMEMsRUFBVzlDLEVBQTBDLFdBQVlLLEdBRWpFMkMsRUFBaUJoRCxFQUEwQyxXQUFZTSxHQUV2RStCLEVBQWVyQyxFQUEwQyxXQUFZTyxHQUVyRXFHLEVBQW1CNUcsRUFBMEMsV0FBWVEsR0FyQjNFdUIsRUFBVUQsRUFBQSxXQUFNLHdCQUNkd0MsRUFBV3dDLFFBQVFDLElBQUl6QyxVQUFZLGFBeVJ2QzlGLEdBQU9ELFNBekZQa0MsS0FBQUEsRUFDQWlELFFBQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICQgZnJvbSAnY2hlZXJpbydcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCdcbmltcG9ydCBhZGRyZXNzRGlnZ2VyIGZyb20gJ2h0bWwtdGFpd2FuLWFkZHJlc3MtZGlnZ2VyJ1xuaW1wb3J0IGFzeW5jIGZyb20gJ2FzeW5jLXEnXG5pbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnXG5pbXBvcnQgaGUgZnJvbSAnaGUnXG5pbXBvcnQgaW1nRGlnZ2VyIGZyb20gJ2h0bWwtaW1nLWRpZ2dlcidcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3JlcXVlc3QtcHJvbWlzZSdcbmltcG9ydCBpc0lTT1N0cmluZyBmcm9tICdpc29zdHJpbmcnXG5cbmxldCBsb2dSb290ID0gZGVidWcoJ3BpeG5ldC1wb3N0cy1jcmF3bGVyJylcbmNvbnN0IE5PREVfRU5WID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgfHwgJ2RldmVsb3BtZW50J1xuXG5hc3luYyBmdW5jdGlvbiBmaW5kKG9wdHMgPSB7fSkge1xuXG4gIGxldCBsb2cgPSBkZWJ1ZyhgJHtsb2dSb290Lm5hbWVzcGFjZX06ZmluZGApXG5cbiAgaWYgKCFvcHRzLnVybCB8fCB0eXBlb2Ygb3B0cy51cmwgIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KCdOZWVkIHVybC4gQVBJIERvY3VtZW50cyA9PiBjcmF3bGVyLmZpbmQoeyB1cmw6U3RyaW5nIH0pJylcbiAgfVxuXG4gIGxvZyhgZmluZCAke29wdHMudXJsfWApXG5cbiAgbGV0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdCh7XG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICB1cmw6IG9wdHMudXJsLFxuICAgIGpzb246IGZhbHNlLFxuICB9KVxuXG4gIGxldCAkYm9keSA9ICQocmVzcG9uc2UpXG5cbiAgbGV0ICRhcnRpY2xlID0gJGJvZHkuZmluZCgnI2FydGljbGUtYXJlYScpLmZpbmQoJ3NjcmlwdCxzdHlsZSx0ZXh0YXJlYScpLnJlbW92ZSgpLmVuZCgpXG5cbiAgbGV0IGJvZHkgPSAnJ1xuICBib2R5ID0gJGFydGljbGUuaHRtbCgpLnRyaW0oKVxuICBib2R5ID0gaGUuZGVjb2RlKGJvZHkpXG5cbiAgbGV0IGltZ1EgPSBpbWdEaWdnZXIuZGlnKGJvZHkpXG4gIGxldCBhZGRyZXNzUSA9IGFkZHJlc3NEaWdnZXIuZGlnKGJvZHkpXG5cbiAgbGV0IHB1Ymxpc2hlZCA9IGRhdGV0aW1lRGlnKCRhcnRpY2xlKVxuXG4gIGxldCB0aXRsZSA9IHRpdGxlRGlnKCRhcnRpY2xlKVxuXG4gIGxldCBbaW1hZ2VzLCBhZGRyZXNzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtpbWdRLCBhZGRyZXNzUV0pXG5cbiAgaW1hZ2VzID0gaW1hZ2VzLm1hcCgoaW1nKSA9PiB7XG5cbiAgICBpZiAoaW1nLnVybC5pbmRleE9mKCcvLycpID09PSAwKSB7XG4gICAgICBpbWcudXJsID0gYGh0dHA6JHtpbWcudXJsfWBcbiAgICB9XG5cbiAgICByZXR1cm4gaW1nLnVybFxuICB9KVxuXG4gIHJldHVybiB7XG4gICAgYWRkcmVzcyxcbiAgICBib2R5LFxuICAgIHB1Ymxpc2hlZCxcbiAgICBpbWFnZXMsXG4gICAgdGl0bGUsXG4gICAgdXJsOiBvcHRzLnVybCxcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBmaW5kQWxsKG9wdHMgPSB7fSkge1xuICBsZXQgbG9nID0gZGVidWcoYCR7bG9nUm9vdC5uYW1lc3BhY2V9OmZpbmRBbGxgKVxuXG4gIGlmICghb3B0cy51cmwgfHwgdHlwZW9mIG9wdHMudXJsICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnTmVlZCB1cmwsIGZpbmRBbGwoeyB1cmw6U3RyaW5nIH0pJylcbiAgfVxuXG4gIC8vIOWQjOaZguacgOWkmiBOIOainee3mlxuICBjb25zdCBUSFJFQURTX0FUX1NBTUVfVElNRSA9IDJcbiAgY29uc3QgVVJMID0gb3B0cy51cmxcbiAgY29uc3QgRkVUQ0hfQUxMID0gKG9wdHMuZmV0Y2hBbGwgPT09IHRydWUpID8gdHJ1ZSA6IGZhbHNlXG4gIGxldCBwYWdlUmFuZ2VzID0gXy5yYW5nZSgxLCAyKSAvLyBbMV1cbiAgbGV0IGFydGljbGVzID0gW11cblxuICBpZiAoRkVUQ0hfQUxMID09PSB0cnVlKSB7XG4gICAgbGV0IG1heFBhZ2VBbW91bnQgPSBhd2FpdCBjcmF3bFBhZ2VzKFVSTClcblxuICAgIGxvZyhg6YOo6JC95qC857i95YWx5pyJICR7bWF4UGFnZUFtb3VudH0g6aCB77yM5piv5ZCm5by35Yi25oqT5Y+W5YWo6YOo6aCB6Z2iOiR7RkVUQ0hfQUxMfWApXG5cbiAgICAvLyBbMSwyLDMsNCwuLi5OXSDpoIFcbiAgICBwYWdlUmFuZ2VzID0gXy5yYW5nZSgxLCBtYXhQYWdlQW1vdW50ICsgMSlcbiAgfVxuXG4gIGxvZyhg5ZCM5pmC6ZaL5LqGICR7VEhSRUFEU19BVF9TQU1FX1RJTUV9IOainemAo+e3mu+8jOeZvOWLleiri+axgu+8gWApXG5cbiAgaWYgKE5PREVfRU5WLm1hdGNoKC90ZXN0L2kpKSB7XG4gICAgbG9nKGBOT0RFX0VOVjoke05PREVfRU5Wfe+8jOiZleeQhiBwYWdlUmFuZ2VzIOiuiumHj++8jOS9v+Wug+acgOWkmuWVj+S4iemggeOAgmApXG5cbiAgICBwYWdlUmFuZ2VzID0gcGFnZVJhbmdlcy5zbGljZSgwLCAzKVxuICB9XG5cbiAgLy8gc2VuZCByZXF1ZXN0c1xuICBhd2FpdCBhc3luYy5lYWNoTGltaXQocGFnZVJhbmdlcywgVEhSRUFEU19BVF9TQU1FX1RJTUUsIGFzeW5jIChwYWdlKSA9PiB7XG4gICAgbGV0IGJsb2dVcmwgPSBgJHtVUkx9LyR7cGFnZX1gXG4gICAgbGV0IGNyYXdsZWQgPSBhd2FpdCBjcmF3bExpc3QoYmxvZ1VybClcbiAgICBhcnRpY2xlcyA9IGFydGljbGVzLmNvbmNhdChjcmF3bGVkKVxuICB9KVxuXG4gIHJldHVybiBhcnRpY2xlc1xufVxuXG4vKipcbkBwYXJhbSB7c3RyaW5nfSB1cmwgLSBCbG9nZ2VyIGJsb2cncyB1cmwgdGhhdCBtYXggcGFnZSBhbW91bnQgeW91IHdhbnQgdG8ga25vd1xuQHJldHVybnMge251bWJlcn0gTWF4IHBhZ2UgYW1vdW50XG4qL1xuZnVuY3Rpb24gY3Jhd2xQYWdlcyh1cmwpIHtcblxuICByZXR1cm4gcmVxdWVzdCh7XG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICB1cmw6IHVybCxcbiAgICBqc29uOiBmYWxzZSxcbiAgfSlcbiAgLnRoZW4oKGJvZHlTdHJpbmcpID0+ICQoYm9keVN0cmluZykpXG4gIC50aGVuKCgkYm9keSkgPT4gbWF4UGFnZURpZygkYm9keSkpXG59XG5cbi8qKlxuQHBhcmFtIHtzdHJpbmd9IHVybCAtIEJsb2dnZXIgYmxvZydzIHVybFxuQHJldHVybnMge29iamVjdC48ZGF0ZXRpbWUsIHRpdGxlLCB1cmw+W119XG4qL1xuZnVuY3Rpb24gY3Jhd2xMaXN0KHVybCkge1xuXG4gIGxldCBsb2cgPSBkZWJ1ZyhgJHtsb2dSb290Lm5hbWVzcGFjZX06X2NyYXdsTGlzdGApXG5cbiAgbG9nKGDnj77lnKjmipPlj5bmuIXllq7vvIznm67mqJk6ICR7dXJsfWApXG4gIHJldHVybiByZXF1ZXN0KHtcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIHVybDogdXJsLFxuICAgIGpzb246IGZhbHNlLFxuICB9KVxuICAudGhlbigoYm9keVN0cmluZykgPT4gJChib2R5U3RyaW5nKSlcbiAgLnRoZW4oKCRib2R5KSA9PiB7XG4gICAgbGV0ICRwb3N0cyA9ICRib2R5LmZpbmQoJy5hcnRpY2xlJylcblxuICAgIGxvZyhg5om+5Ye65pyJICR7JHBvc3RzLmxlbmd0aH0g56+H5paH56ug5a+m5L6L77yM6ZaL5aeL6Kej5p6Q5ZCE56+H5paH56ug6KGo6Z2i57Sw56+A44CCYClcbiAgICBsZXQgcG9zdHMgPSBfLm1hcCgkcG9zdHMsIChhcnRpY2xlRWxlbWVudCkgPT4ge1xuICAgICAgbGV0ICRlbGVtZW50ID0gJChhcnRpY2xlRWxlbWVudClcblxuICAgICAgbGV0IHB1Ymxpc2hlZCA9IGRhdGV0aW1lRGlnKCRlbGVtZW50KVxuXG4gICAgICBsZXQgdGl0bGUgPSB0aXRsZURpZygkZWxlbWVudClcblxuICAgICAgbGV0ICR1cmwgPSAkZWxlbWVudC5maW5kKCcudGl0bGUnKVxuICAgICAgbGV0IHBvc3RVcmwgPSAkdXJsLmZpbmQoJ2EnKS5hdHRyKCdocmVmJykudHJpbSgpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHB1Ymxpc2hlZCxcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIHVybDogcG9zdFVybCxcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIHBvc3RzXG4gIH0pXG59XG5cbmZ1bmN0aW9uIG1heFBhZ2VEaWcoJGVsZW1lbnQpIHtcblxuICBsZXQgYWxpbmtzID0gJGVsZW1lbnQuZmluZCgnLnBhZ2UgYScpXG5cbiAgbGV0IHBhZ2VzID0gXy5tYXAoYWxpbmtzLCAoYUVsZW1lbnQpID0+IHtcbiAgICBsZXQgcGFnZU51bSA9IE51bWJlcigkKGFFbGVtZW50KS50ZXh0KCkpXG4gICAgaWYgKE51bWJlci5pc05hTihwYWdlTnVtKSkge1xuICAgICAgcmV0dXJuIDBcbiAgICB9XG5cbiAgICByZXR1cm4gcGFnZU51bVxuICB9KVxuXG4gIGxldCBtYXhQYWdlID0gXy5tYXgocGFnZXMpXG5cbiAgcmV0dXJuIG1heFBhZ2Vcbn1cblxuZnVuY3Rpb24gZGF0ZXRpbWVEaWcoJGVsZW1lbnQpIHtcblxuICBsZXQgJHB1YiA9ICRlbGVtZW50LmZpbmQoJy5wdWJsaXNoJylcbiAgbGV0IG1vbnRoID0gJHB1Yi5maW5kKCcubW9udGgnKS50ZXh0KCkudHJpbSgpIC8vIEp1bFxuICBsZXQgZGF0ZSA9ICRwdWIuZmluZCgnLmRhdGUnKS50ZXh0KCkudHJpbSgpIC8vIDA3XG4gIGxldCB5ZWFyID0gJHB1Yi5maW5kKCcueWVhcicpLnRleHQoKS50cmltKCkgLy8gMjAxNVxuICBsZXQgdGltZSA9ICRwdWIuZmluZCgnLnRpbWUnKS50ZXh0KCkudHJpbSgpIC8vIDEzOjEyXG5cbiAgbGV0IGRhdGV0aW1lID0gbmV3IERhdGUoYCR7bW9udGh9ICR7ZGF0ZX0gJHt5ZWFyfSAke3RpbWV9YClcbiAgbGV0IGlzb3N0cmluZyA9IGRhdGV0aW1lLnRvSVNPU3RyaW5nKClcbiAgaXNvc3RyaW5nID0gKGlzSVNPU3RyaW5nKGlzb3N0cmluZykpID8gaXNvc3RyaW5nIDogJydcblxuICByZXR1cm4gaXNvc3RyaW5nXG59XG5cbmZ1bmN0aW9uIHRpdGxlRGlnKCRlbGVtZW50KSB7XG5cbiAgbGV0ICR0aXRsZSA9ICRlbGVtZW50LmZpbmQoJy50aXRsZScpXG4gIGxldCB0aXRsZSA9ICR0aXRsZS5maW5kKCdhJykudGV4dCgpLnRyaW0oKVxuXG4gIHJldHVybiB0aXRsZVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGZpbmQsXG4gIGZpbmRBbGwsXG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=