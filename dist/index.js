!function(e,r){if("function"==typeof define&&define.amd)define("gulpEasyTaskBabelModuleId3715074",["exports","module","babel-runtime/helpers/sliced-to-array","babel-runtime/regenerator","babel-runtime/core-js/promise","babel-runtime/core-js/number/is-nan","babel-runtime/core-js/array/from","cheerio","babel-runtime/helpers/interop-require-default","lodash","html-taiwan-address-digger","async-q","debug","he","html-img-digger","request-promise","isostring"],r);else if("undefined"!=typeof exports&&"undefined"!=typeof module)r(exports,module,require("babel-runtime/helpers/sliced-to-array"),require("babel-runtime/regenerator"),require("babel-runtime/core-js/promise"),require("babel-runtime/core-js/number/is-nan"),require("babel-runtime/core-js/array/from"),require("cheerio"),require("babel-runtime/helpers/interop-require-default"),require("lodash"),require("html-taiwan-address-digger"),require("async-q"),require("debug"),require("he"),require("html-img-digger"),require("request-promise"),require("isostring"));else{var t={exports:{}};r(t.exports,t,e._slicedToArray,e._regeneratorRuntime,e._Promise,e._Number$isNaN,e._Array$from,e.$,e._interopRequireDefault,e._,e.addressDigger,e.async,e.debug,e.he,e.imgDigger,e.request,e.isISOString),e.gulpEasyTaskBabelModuleId3715074=t.exports}}(this,function(e,r,t,n,u,a,i,l,d,s,f,o,c,m,p,h,g){"use strict";function b(){var e,r,a,i,l,d,s,f,o,c,m,p,h,g,b=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return n["default"].async(function(x){for(;;)switch(x.prev=x.next){case 0:if(e=S["default"](G.namespace+":find"),b.url&&"string"==typeof b.url){x.next=3;break}return x.abrupt("return",u["default"].reject("Need url. API Documents => crawler.find({ url:String })"));case 3:return e("find "+b.url),x.next=6,n["default"].awrap(O["default"]({method:"GET",url:b.url,json:!1}));case 6:return r=x.sent,a=E["default"](r),i=a.find("#article-area").find("script,style,textarea").remove().end(),l="",l=i.html().trim(),l=T["default"].decode(l),d=k["default"].dig(l),s=D["default"].dig(l),x.next=16,n["default"].awrap(N(i));case 16:return f=x.sent,o=w(i),c=j(i),x.next=21,n["default"].awrap(u["default"].all([d,s]));case 21:return m=x.sent,p=t["default"](m,2),h=p[0],g=p[1],h=h.map(function(e){return 0===e.url.indexOf("//")&&(e.url="http:"+e.url),e.url}),h=h.concat(f),x.abrupt("return",{address:g,body:l,published:o,images:h,title:c,url:b.url});case 28:case"end":return x.stop()}},null,this)}function x(){var e,r,t,a,i,l,d,s=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];return n["default"].async(function(f){for(var o=this;;)switch(f.prev=f.next){case 0:if(e=S["default"](G.namespace+":findAll"),s.url&&"string"==typeof s.url){f.next=3;break}return f.abrupt("return",u["default"].reject("Need url, findAll({ url:String })"));case 3:if(r=2,t=s.url,a=s.fetchAll===!0?!0:!1,i=_["default"].range(1,2),l=[],a!==!0){f.next=14;break}return f.next=11,n["default"].awrap(v(t));case 11:d=f.sent,e("部落格總共有 "+d+" 頁，是否強制抓取全部頁面:"+a),i=_["default"].range(1,d+1);case 14:return e("同時開了 "+r+" 條連線，發動請求！"),R.match(/test/i)&&(e("NODE_ENV:"+R+"，處理 pageRanges 變量，使它最多問三頁。"),i=i.slice(0,3)),f.next=18,n["default"].awrap(A["default"].eachLimit(i,r,function(e){var r,u;return n["default"].async(function(a){for(;;)switch(a.prev=a.next){case 0:return r=t+"/"+e,a.next=3,n["default"].awrap(q(r));case 3:u=a.sent,l=l.concat(u);case 5:case"end":return a.stop()}},null,o)}));case 18:return f.abrupt("return",l);case 19:case"end":return f.stop()}},null,this)}function v(e){return O["default"]({method:"GET",url:e,json:!1}).then(function(e){return E["default"](e)}).then(function(e){return y(e)})}function q(e){var r=S["default"](G.namespace+":_crawlList");return r("現在抓取清單，目標: "+e),O["default"]({method:"GET",url:e,json:!1}).then(function(e){return E["default"](e)}).then(function(e){var t=e.find(".article");r("找出有 "+t.length+" 篇文章實例，開始解析各篇文章表面細節。");var n=_["default"].map(t,function(e){var r=E["default"](e),t=w(r),n=j(r),u=r.find(".title"),a=u.find("a").attr("href").trim();return{published:t,title:n,url:a}});return n})}function y(e){var r=e.find(".page a"),t=_["default"].map(r,function(e){var r=Number(E["default"](e).text());return a["default"](r)?0:r}),n=_["default"].max(t);return n}function w(e){var r=e.find(".publish"),t=r.find(".month").text().trim(),n=r.find(".date").text().trim(),u=r.find(".year").text().trim(),a=r.find(".time").text().trim(),i=new Date(t+" "+n+" "+u+" "+a),l=i.toISOString();return l=I["default"](l)?l:""}function j(e){var r=e.find(".title"),t=r.find("a").text().trim();return t}function N(e){var r=e.find('iframe[src*="flickr"]'),n=i["default"](r).reduce(function(e,r,n){var u=O["default"]({method:"GET",url:E["default"](r).attr("src"),json:!1}).then(function(e){var r=e.match(/Y\.ContextData\.add\((.*?)\)/im)||[],n=t["default"](r,2),u=(n[0],n[1]);if(u){var a=JSON.parse(u);return a.photos[0].photo.sizes.l.url}return null})["catch"](function(e){return console.error(e)});return e.push(u),e},[]);return u["default"].all(n).then(function(e){return e.filter(function(e){return e})})["catch"](function(e){return[]})}var E=d["default"](l),_=d["default"](s),D=d["default"](f),A=d["default"](o),S=d["default"](c),T=d["default"](m),k=d["default"](p),O=d["default"](h),I=d["default"](g),G=S["default"]("pixnet-posts-crawler"),R=process.env.NODE_ENV||"development";r.exports={find:b,findAll:x}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImdsb2JhbCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJleHBvcnRzIiwibW9kdWxlIiwicmVxdWlyZSIsIm1vZCIsIl9zbGljZWRUb0FycmF5IiwiX3JlZ2VuZXJhdG9yUnVudGltZSIsIl9Qcm9taXNlIiwiX051bWJlciRpc05hTiIsIl9BcnJheSRmcm9tIiwiJCIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfIiwiYWRkcmVzc0RpZ2dlciIsImFzeW5jIiwiZGVidWciLCJoZSIsImltZ0RpZ2dlciIsInJlcXVlc3QiLCJpc0lTT1N0cmluZyIsImd1bHBFYXN5VGFza0JhYmVsTW9kdWxlSWQzNzE1MDc0IiwidGhpcyIsIl9iYWJlbFJ1bnRpbWVIZWxwZXJzU2xpY2VkVG9BcnJheSIsIl9iYWJlbFJ1bnRpbWVSZWdlbmVyYXRvciIsIl9iYWJlbFJ1bnRpbWVDb3JlSnNQcm9taXNlIiwiX2JhYmVsUnVudGltZUNvcmVKc051bWJlcklzTmFuIiwiX2JhYmVsUnVudGltZUNvcmVKc0FycmF5RnJvbSIsIl9jaGVlcmlvIiwiX2JhYmVsUnVudGltZUhlbHBlcnNJbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJfbG9kYXNoIiwiX2h0bWxUYWl3YW5BZGRyZXNzRGlnZ2VyIiwiX2FzeW5jUSIsIl9kZWJ1ZyIsIl9oZSIsIl9odG1sSW1nRGlnZ2VyIiwiX3JlcXVlc3RQcm9taXNlIiwiX2lzb3N0cmluZyIsImZpbmQiLCJsb2ciLCJyZXNwb25zZSIsIiRib2R5IiwiJGFydGljbGUiLCJib2R5IiwiaW1nUSIsImFkZHJlc3NRIiwiZmxpY2tySW1ncyIsInB1Ymxpc2hlZCIsInRpdGxlIiwiX3JlZiIsIl9yZWYyIiwiaW1hZ2VzIiwiYWRkcmVzcyIsIm9wdHMiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJjb250ZXh0JDEkMCIsInByZXYiLCJuZXh0IiwiX2RlYnVnMiIsImxvZ1Jvb3QiLCJuYW1lc3BhY2UiLCJ1cmwiLCJhYnJ1cHQiLCJyZWplY3QiLCJhd3JhcCIsIl9yZXF1ZXN0IiwibWV0aG9kIiwianNvbiIsInNlbnQiLCJfJCIsInJlbW92ZSIsImVuZCIsImh0bWwiLCJ0cmltIiwiX2hlMiIsImRlY29kZSIsIl9pbWdEaWdnZXIiLCJkaWciLCJfYWRkcmVzc0RpZ2dlciIsImZsaWNrckRpZyIsImRhdGV0aW1lRGlnIiwidGl0bGVEaWciLCJhbGwiLCJtYXAiLCJpbWciLCJpbmRleE9mIiwiY29uY2F0Iiwic3RvcCIsImZpbmRBbGwiLCJUSFJFQURTX0FUX1NBTUVfVElNRSIsIlVSTCIsIkZFVENIX0FMTCIsInBhZ2VSYW5nZXMiLCJhcnRpY2xlcyIsIm1heFBhZ2VBbW91bnQiLCJfdGhpcyIsImZldGNoQWxsIiwiXzIiLCJyYW5nZSIsImNyYXdsUGFnZXMiLCJOT0RFX0VOViIsIm1hdGNoIiwic2xpY2UiLCJfYXN5bmMiLCJlYWNoTGltaXQiLCJwYWdlIiwiYmxvZ1VybCIsImNyYXdsZWQiLCJjb250ZXh0JDIkMCIsImNyYXdsTGlzdCIsInRoZW4iLCJib2R5U3RyaW5nIiwibWF4UGFnZURpZyIsIiRwb3N0cyIsInBvc3RzIiwiYXJ0aWNsZUVsZW1lbnQiLCIkZWxlbWVudCIsIiR1cmwiLCJwb3N0VXJsIiwiYXR0ciIsImFsaW5rcyIsInBhZ2VzIiwiYUVsZW1lbnQiLCJwYWdlTnVtIiwiTnVtYmVyIiwidGV4dCIsIm1heFBhZ2UiLCJtYXgiLCIkcHViIiwibW9udGgiLCJkYXRlIiwieWVhciIsInRpbWUiLCJkYXRldGltZSIsIkRhdGUiLCJpc29zdHJpbmciLCJ0b0lTT1N0cmluZyIsIl9pc0lTT1N0cmluZyIsIiR0aXRsZSIsImZsaWNrclBsYXllcnMiLCJwcm9taXNlcyIsInJlZHVjZSIsImVsZW1lbnQiLCJpbmRleCIsInByb21pc2UiLCJyZXN1bHQiLCJfcmVmMyIsIl9yZWYzMiIsIm1hdGNoMSIsInBob3RvcyIsIkpTT04iLCJwYXJzZSIsInBob3RvIiwic2l6ZXMiLCJsIiwiZXJyIiwiY29uc29s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LEdBbUcvQixNQW5HMENBLEdBQU9jLE9BQU8sU0FBQ0MsR0FvR3ZELE1BcEdnRUEsT0FBTSxTQUNyRSxTQUFDTCxHQXNHSixXQWhVSixHQUFJdEYsR0FBUzFDLEVBQTBDLFdBQVlELEdBRS9EdUUsRUFBU3RFLEVBQTBDLFdBQVlDLEdBRS9Ea0QsRUFBcUJuRCxFQUEwQyxXQUFZRSxHQUUzRTBFLEVBQWE1RSxFQUEwQyxXQUFZRyxHQUVuRTRCLEVBQWMvQixFQUEwQyxXQUFZSSxHQUVwRTJDLEVBQVcvQyxFQUEwQyxXQUFZSyxHQUVqRTRDLEVBQWlCakQsRUFBMEMsV0FBWU0sR0FFdkVnQyxFQUFldEMsRUFBMEMsV0FBWU8sR0FFckV1RyxFQUFtQjlHLEVBQTBDLFdBQVlRLEdBckIzRXdCLEVBQVVELEVBQUEsV0FBTSx3QkFDZDBDLEVBQVc2RCxRQUFRQyxJQUFJOUQsVUFBWSxhQXdVdkNuRyxHQUFPRCxTQXRHUG9DLEtBQUFBLEVBQ0FvRCxRQUFBQSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAkIGZyb20gJ2NoZWVyaW8nXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnXG5pbXBvcnQgYWRkcmVzc0RpZ2dlciBmcm9tICdodG1sLXRhaXdhbi1hZGRyZXNzLWRpZ2dlcidcbmltcG9ydCBhc3luYyBmcm9tICdhc3luYy1xJ1xuaW1wb3J0IGRlYnVnIGZyb20gJ2RlYnVnJ1xuaW1wb3J0IGhlIGZyb20gJ2hlJ1xuaW1wb3J0IGltZ0RpZ2dlciBmcm9tICdodG1sLWltZy1kaWdnZXInXG5pbXBvcnQgcmVxdWVzdCBmcm9tICdyZXF1ZXN0LXByb21pc2UnXG5pbXBvcnQgaXNJU09TdHJpbmcgZnJvbSAnaXNvc3RyaW5nJ1xuXG5sZXQgbG9nUm9vdCA9IGRlYnVnKCdwaXhuZXQtcG9zdHMtY3Jhd2xlcicpXG5jb25zdCBOT0RFX0VOViA9IHByb2Nlc3MuZW52Lk5PREVfRU5WIHx8ICdkZXZlbG9wbWVudCdcblxuYXN5bmMgZnVuY3Rpb24gZmluZChvcHRzID0ge30pIHtcblxuICBsZXQgbG9nID0gZGVidWcoYCR7bG9nUm9vdC5uYW1lc3BhY2V9OmZpbmRgKVxuXG4gIGlmICghb3B0cy51cmwgfHwgdHlwZW9mIG9wdHMudXJsICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnTmVlZCB1cmwuIEFQSSBEb2N1bWVudHMgPT4gY3Jhd2xlci5maW5kKHsgdXJsOlN0cmluZyB9KScpXG4gIH1cblxuICBsb2coYGZpbmQgJHtvcHRzLnVybH1gKVxuXG4gIGxldCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3Qoe1xuICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgdXJsOiBvcHRzLnVybCxcbiAgICBqc29uOiBmYWxzZSxcbiAgfSlcblxuICBsZXQgJGJvZHkgPSAkKHJlc3BvbnNlKVxuXG4gIGxldCAkYXJ0aWNsZSA9ICRib2R5LmZpbmQoJyNhcnRpY2xlLWFyZWEnKS5maW5kKCdzY3JpcHQsc3R5bGUsdGV4dGFyZWEnKS5yZW1vdmUoKS5lbmQoKVxuXG4gIGxldCBib2R5ID0gJydcbiAgYm9keSA9ICRhcnRpY2xlLmh0bWwoKS50cmltKClcbiAgYm9keSA9IGhlLmRlY29kZShib2R5KVxuXG4gIGxldCBpbWdRID0gaW1nRGlnZ2VyLmRpZyhib2R5KVxuICBsZXQgYWRkcmVzc1EgPSBhZGRyZXNzRGlnZ2VyLmRpZyhib2R5KVxuICBsZXQgZmxpY2tySW1ncyA9IGF3YWl0IGZsaWNrckRpZygkYXJ0aWNsZSlcblxuICBsZXQgcHVibGlzaGVkID0gZGF0ZXRpbWVEaWcoJGFydGljbGUpXG5cbiAgbGV0IHRpdGxlID0gdGl0bGVEaWcoJGFydGljbGUpXG5cbiAgbGV0IFtpbWFnZXMsIGFkZHJlc3NdID0gYXdhaXQgUHJvbWlzZS5hbGwoW2ltZ1EsIGFkZHJlc3NRXSlcblxuICBpbWFnZXMgPSBpbWFnZXMubWFwKChpbWcpID0+IHtcblxuICAgIGlmIChpbWcudXJsLmluZGV4T2YoJy8vJykgPT09IDApIHtcbiAgICAgIGltZy51cmwgPSBgaHR0cDoke2ltZy51cmx9YFxuICAgIH1cblxuICAgIHJldHVybiBpbWcudXJsXG4gIH0pXG5cbiAgaW1hZ2VzID0gaW1hZ2VzLmNvbmNhdChmbGlja3JJbWdzKVxuXG4gIHJldHVybiB7XG4gICAgYWRkcmVzcyxcbiAgICBib2R5LFxuICAgIHB1Ymxpc2hlZCxcbiAgICBpbWFnZXMsXG4gICAgdGl0bGUsXG4gICAgdXJsOiBvcHRzLnVybCxcbiAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBmaW5kQWxsKG9wdHMgPSB7fSkge1xuICBsZXQgbG9nID0gZGVidWcoYCR7bG9nUm9vdC5uYW1lc3BhY2V9OmZpbmRBbGxgKVxuXG4gIGlmICghb3B0cy51cmwgfHwgdHlwZW9mIG9wdHMudXJsICE9PSAnc3RyaW5nJykge1xuICAgIHJldHVybiBQcm9taXNlLnJlamVjdCgnTmVlZCB1cmwsIGZpbmRBbGwoeyB1cmw6U3RyaW5nIH0pJylcbiAgfVxuXG4gIC8vIOWQjOaZguacgOWkmiBOIOainee3mlxuICBjb25zdCBUSFJFQURTX0FUX1NBTUVfVElNRSA9IDJcbiAgY29uc3QgVVJMID0gb3B0cy51cmxcbiAgY29uc3QgRkVUQ0hfQUxMID0gKG9wdHMuZmV0Y2hBbGwgPT09IHRydWUpID8gdHJ1ZSA6IGZhbHNlXG4gIGxldCBwYWdlUmFuZ2VzID0gXy5yYW5nZSgxLCAyKSAvLyBbMV1cbiAgbGV0IGFydGljbGVzID0gW11cblxuICBpZiAoRkVUQ0hfQUxMID09PSB0cnVlKSB7XG4gICAgbGV0IG1heFBhZ2VBbW91bnQgPSBhd2FpdCBjcmF3bFBhZ2VzKFVSTClcblxuICAgIGxvZyhg6YOo6JC95qC857i95YWx5pyJICR7bWF4UGFnZUFtb3VudH0g6aCB77yM5piv5ZCm5by35Yi25oqT5Y+W5YWo6YOo6aCB6Z2iOiR7RkVUQ0hfQUxMfWApXG5cbiAgICAvLyBbMSwyLDMsNCwuLi5OXSDpoIFcbiAgICBwYWdlUmFuZ2VzID0gXy5yYW5nZSgxLCBtYXhQYWdlQW1vdW50ICsgMSlcbiAgfVxuXG4gIGxvZyhg5ZCM5pmC6ZaL5LqGICR7VEhSRUFEU19BVF9TQU1FX1RJTUV9IOainemAo+e3mu+8jOeZvOWLleiri+axgu+8gWApXG5cbiAgaWYgKE5PREVfRU5WLm1hdGNoKC90ZXN0L2kpKSB7XG4gICAgbG9nKGBOT0RFX0VOVjoke05PREVfRU5Wfe+8jOiZleeQhiBwYWdlUmFuZ2VzIOiuiumHj++8jOS9v+Wug+acgOWkmuWVj+S4iemggeOAgmApXG5cbiAgICBwYWdlUmFuZ2VzID0gcGFnZVJhbmdlcy5zbGljZSgwLCAzKVxuICB9XG5cbiAgLy8gc2VuZCByZXF1ZXN0c1xuICBhd2FpdCBhc3luYy5lYWNoTGltaXQocGFnZVJhbmdlcywgVEhSRUFEU19BVF9TQU1FX1RJTUUsIGFzeW5jIChwYWdlKSA9PiB7XG4gICAgbGV0IGJsb2dVcmwgPSBgJHtVUkx9LyR7cGFnZX1gXG4gICAgbGV0IGNyYXdsZWQgPSBhd2FpdCBjcmF3bExpc3QoYmxvZ1VybClcbiAgICBhcnRpY2xlcyA9IGFydGljbGVzLmNvbmNhdChjcmF3bGVkKVxuICB9KVxuXG4gIHJldHVybiBhcnRpY2xlc1xufVxuXG4vKipcbkBwYXJhbSB7c3RyaW5nfSB1cmwgLSBCbG9nZ2VyIGJsb2cncyB1cmwgdGhhdCBtYXggcGFnZSBhbW91bnQgeW91IHdhbnQgdG8ga25vd1xuQHJldHVybnMge251bWJlcn0gTWF4IHBhZ2UgYW1vdW50XG4qL1xuZnVuY3Rpb24gY3Jhd2xQYWdlcyh1cmwpIHtcblxuICByZXR1cm4gcmVxdWVzdCh7XG4gICAgbWV0aG9kOiAnR0VUJyxcbiAgICB1cmw6IHVybCxcbiAgICBqc29uOiBmYWxzZSxcbiAgfSlcbiAgLnRoZW4oKGJvZHlTdHJpbmcpID0+ICQoYm9keVN0cmluZykpXG4gIC50aGVuKCgkYm9keSkgPT4gbWF4UGFnZURpZygkYm9keSkpXG59XG5cbi8qKlxuQHBhcmFtIHtzdHJpbmd9IHVybCAtIEJsb2dnZXIgYmxvZydzIHVybFxuQHJldHVybnMge29iamVjdC48ZGF0ZXRpbWUsIHRpdGxlLCB1cmw+W119XG4qL1xuZnVuY3Rpb24gY3Jhd2xMaXN0KHVybCkge1xuXG4gIGxldCBsb2cgPSBkZWJ1ZyhgJHtsb2dSb290Lm5hbWVzcGFjZX06X2NyYXdsTGlzdGApXG5cbiAgbG9nKGDnj77lnKjmipPlj5bmuIXllq7vvIznm67mqJk6ICR7dXJsfWApXG4gIHJldHVybiByZXF1ZXN0KHtcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIHVybDogdXJsLFxuICAgIGpzb246IGZhbHNlLFxuICB9KVxuICAudGhlbigoYm9keVN0cmluZykgPT4gJChib2R5U3RyaW5nKSlcbiAgLnRoZW4oKCRib2R5KSA9PiB7XG4gICAgbGV0ICRwb3N0cyA9ICRib2R5LmZpbmQoJy5hcnRpY2xlJylcblxuICAgIGxvZyhg5om+5Ye65pyJICR7JHBvc3RzLmxlbmd0aH0g56+H5paH56ug5a+m5L6L77yM6ZaL5aeL6Kej5p6Q5ZCE56+H5paH56ug6KGo6Z2i57Sw56+A44CCYClcbiAgICBsZXQgcG9zdHMgPSBfLm1hcCgkcG9zdHMsIChhcnRpY2xlRWxlbWVudCkgPT4ge1xuICAgICAgbGV0ICRlbGVtZW50ID0gJChhcnRpY2xlRWxlbWVudClcblxuICAgICAgbGV0IHB1Ymxpc2hlZCA9IGRhdGV0aW1lRGlnKCRlbGVtZW50KVxuXG4gICAgICBsZXQgdGl0bGUgPSB0aXRsZURpZygkZWxlbWVudClcblxuICAgICAgbGV0ICR1cmwgPSAkZWxlbWVudC5maW5kKCcudGl0bGUnKVxuICAgICAgbGV0IHBvc3RVcmwgPSAkdXJsLmZpbmQoJ2EnKS5hdHRyKCdocmVmJykudHJpbSgpXG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHB1Ymxpc2hlZCxcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIHVybDogcG9zdFVybCxcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIHBvc3RzXG4gIH0pXG59XG5cbmZ1bmN0aW9uIG1heFBhZ2VEaWcoJGVsZW1lbnQpIHtcblxuICBsZXQgYWxpbmtzID0gJGVsZW1lbnQuZmluZCgnLnBhZ2UgYScpXG5cbiAgbGV0IHBhZ2VzID0gXy5tYXAoYWxpbmtzLCAoYUVsZW1lbnQpID0+IHtcbiAgICBsZXQgcGFnZU51bSA9IE51bWJlcigkKGFFbGVtZW50KS50ZXh0KCkpXG4gICAgaWYgKE51bWJlci5pc05hTihwYWdlTnVtKSkge1xuICAgICAgcmV0dXJuIDBcbiAgICB9XG5cbiAgICByZXR1cm4gcGFnZU51bVxuICB9KVxuXG4gIGxldCBtYXhQYWdlID0gXy5tYXgocGFnZXMpXG5cbiAgcmV0dXJuIG1heFBhZ2Vcbn1cblxuZnVuY3Rpb24gZGF0ZXRpbWVEaWcoJGVsZW1lbnQpIHtcblxuICBsZXQgJHB1YiA9ICRlbGVtZW50LmZpbmQoJy5wdWJsaXNoJylcbiAgbGV0IG1vbnRoID0gJHB1Yi5maW5kKCcubW9udGgnKS50ZXh0KCkudHJpbSgpIC8vIEp1bFxuICBsZXQgZGF0ZSA9ICRwdWIuZmluZCgnLmRhdGUnKS50ZXh0KCkudHJpbSgpIC8vIDA3XG4gIGxldCB5ZWFyID0gJHB1Yi5maW5kKCcueWVhcicpLnRleHQoKS50cmltKCkgLy8gMjAxNVxuICBsZXQgdGltZSA9ICRwdWIuZmluZCgnLnRpbWUnKS50ZXh0KCkudHJpbSgpIC8vIDEzOjEyXG5cbiAgbGV0IGRhdGV0aW1lID0gbmV3IERhdGUoYCR7bW9udGh9ICR7ZGF0ZX0gJHt5ZWFyfSAke3RpbWV9YClcbiAgbGV0IGlzb3N0cmluZyA9IGRhdGV0aW1lLnRvSVNPU3RyaW5nKClcbiAgaXNvc3RyaW5nID0gKGlzSVNPU3RyaW5nKGlzb3N0cmluZykpID8gaXNvc3RyaW5nIDogJydcblxuICByZXR1cm4gaXNvc3RyaW5nXG59XG5cbmZ1bmN0aW9uIHRpdGxlRGlnKCRlbGVtZW50KSB7XG5cbiAgbGV0ICR0aXRsZSA9ICRlbGVtZW50LmZpbmQoJy50aXRsZScpXG4gIGxldCB0aXRsZSA9ICR0aXRsZS5maW5kKCdhJykudGV4dCgpLnRyaW0oKVxuXG4gIHJldHVybiB0aXRsZVxufVxuXG5mdW5jdGlvbiBmbGlja3JEaWcoJGVsZW1lbnQpIHtcbiAgbGV0IGZsaWNrclBsYXllcnMgPSAkZWxlbWVudC5maW5kKCdpZnJhbWVbc3JjKj1cImZsaWNrclwiXScpXG5cbiAgbGV0IHByb21pc2VzID0gQXJyYXkuZnJvbShmbGlja3JQbGF5ZXJzKS5yZWR1Y2UoKHByb21pc2VzLCBlbGVtZW50LCBpbmRleCkgPT4ge1xuICAgIGxldCBwcm9taXNlID0gcmVxdWVzdCh7XG4gICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgdXJsOiAkKGVsZW1lbnQpLmF0dHIoJ3NyYycpLFxuICAgICAganNvbjogZmFsc2UsXG4gICAgfSlcbiAgICAudGhlbigocmVzdWx0KSA9PiB7XG4gICAgICBsZXQgW2NvbnRleHQsIG1hdGNoMV0gPSByZXN1bHQubWF0Y2goL1lcXC5Db250ZXh0RGF0YVxcLmFkZFxcKCguKj8pXFwpL2ltKSB8fCBbXVxuXG4gICAgICBpZiAobWF0Y2gxKSB7XG4gICAgICAgIGxldCBwaG90b3MgPSBKU09OLnBhcnNlKG1hdGNoMSlcbiAgICAgICAgcmV0dXJuIHBob3Rvcy5waG90b3NbMF0ucGhvdG8uc2l6ZXMubC51cmxcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoZXJyKSlcblxuICAgIHByb21pc2VzLnB1c2gocHJvbWlzZSlcbiAgICByZXR1cm4gcHJvbWlzZXNcbiAgfSwgW10pXG5cbiAgLy8gcmVqZWN0ICFpdGVtXG4gIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbigocmVzdWx0KSA9PiByZXN1bHQuZmlsdGVyKChpdGVtKSA9PiBpdGVtKSlcbiAgLmNhdGNoKChlcnIpID0+IFtdKVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGZpbmQsXG4gIGZpbmRBbGwsXG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=